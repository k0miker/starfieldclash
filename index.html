<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starfield Warp Animation</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
            overflow: hidden;
            color: white;
        }

        #score {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }

        #gameover {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            display: none;
            color: red;
        }

        #highscore {
            position: absolute;
            top: 40px;
            right: 10px;
            font-size: 20px;
        }
    </style>
</head>

<body>
    <canvas id="2dcanvas"></canvas>
    <div id="score">Score: 0</div>
    <div id="highscore">High Score: 0</div>
    <div id="gameover">Game Over! Click to Restart</div>

    <script>
        const canvas = document.getElementById('2dcanvas');
        const scoreDiv = document.getElementById('score');
        const highScoreDiv = document.getElementById('highscore');
        const gameOverDiv = document.getElementById('gameover');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const context = canvas.getContext("2d");

        let numStars = 500;
        const stars = [];
        const comets = [];
        let baseSpeed = 5;
        let speed = baseSpeed;
        let score = 0;
        let isGameOver = false;
        let highScore = localStorage.getItem('highScore') || 0;

        let speedIncreaseInterval;
        let speedDecreaseInterval;

        const ship = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            width: 50,
            height: 50
        };

        const shipImg = new Image();
        shipImg.src = 'ship.png'; // Make sure to have ship.png in the correct directory

        function createStar(index) {
            let x, y;
            do {
                x = Math.random() * canvas.width;
                y = Math.random() * canvas.height;
            } while (Math.hypot(x - ship.x, y - ship.y) < 50); // Ensure star is at least 50px away from the ship

            return {
                x,
                y,
                z: Math.random() * canvas.width,
                o: Math.random(),
                size: Math.max((Math.random() * 10 + 3), 1) * (index % 50 === 0 ? 3 : 1), // Minimum size 4x4 pixels, tripled if special
                isSpecial: index % 50 === 0 // Every 50th star is special
            };
        }

        function createComet() {
            const direction = Math.floor(Math.random() * 4);
            let x, y, vx, vy;

            switch (direction) {
                case 0: // from top
                    x = Math.random() * canvas.width;
                    y = 0;
                    vx = (Math.random() - 0.5) * 10;
                    vy = Math.random() * 5 + 2;
                    break;
                case 1: // from bottom
                    x = Math.random() * canvas.width;
                    y = canvas.height;
                    vx = (Math.random() - 0.5) * 10;
                    vy = -(Math.random() * 5 + 2);
                    break;
                case 2: // from left
                    x = 0;
                    y = Math.random() * canvas.height;
                    vx = Math.random() * 5 + 2;
                    vy = (Math.random() - 0.5) * 10;
                    break;
                case 3: // from right
                    x = canvas.width;
                    y = Math.random() * canvas.height;
                    vx = -(Math.random() * 5 + 2);
                    vy = (Math.random() - 0.5) * 10;
                    break;
            }

            return {
                x,
                y,
                vx,
                vy,
                size: Math.random() * 8 + 5
            };
        }

        function populateStars() {
            stars.length = 0;
            for (let i = 0; i < numStars; i++) {
                stars.push(createStar(i));
            }
        }

        document.addEventListener('keydown', (event) => {
            if (event.code === 'ArrowUp' || event.code === 'KeyW') {
                clearInterval(speedDecreaseInterval);
                speedIncreaseInterval = setInterval(() => {
                    speed += 2;
                }, 100);
            } else if (event.code === 'ArrowDown' || event.code === 'KeyS') {
                clearInterval(speedIncreaseInterval);
                speedDecreaseInterval = setInterval(() => {
                    speed = Math.max(1, speed - 2);
                }, 100);
            } else if (event.code === 'NumpadAdd') {
                numStars += 100;
                populateStars();
            } else if (event.code === 'NumpadSubtract') {
                numStars = Math.max(100, numStars - 100);
                populateStars();
            }
        });

        document.addEventListener('keyup', (event) => {
            if (event.code === 'ArrowUp' || event.code === 'KeyW') {
                clearInterval(speedIncreaseInterval);
            } else if (event.code === 'ArrowDown' || event.code === 'KeyS') {
                clearInterval(speedDecreaseInterval);
            }
        });

        canvas.addEventListener('mousemove', (event) => {
            if (!isGameOver) {
                ship.x = event.clientX;
                ship.y = event.clientY;
            }
        });

        canvas.addEventListener('click', (event) => {
            ship.x = event.clientX;
            ship.y = event.clientY;
            resetGame();
        });

        function resetGame() {
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('highScore', highScore);
            }
            score = 0;
            speed = baseSpeed;
            numStars = 1500;
            isGameOver = false;
            gameOverDiv.style.display = 'none';
            populateStars();
            comets.length = 0;
            updateStars();
        }

        function gameOver() {
            isGameOver = true;
            gameOverDiv.style.display = 'block';
            highScoreDiv.textContent = `High Score: ${highScore}`;
        }

        function updateStars() {
            if (isGameOver) return;

            context.clearRect(0, 0, canvas.width, canvas.height);

            context.drawImage(shipImg, ship.x - ship.width / 2, ship.y - ship.height / 2, ship.width, ship.height);

            for (let i = 0; i < stars.length; i++) {
                let star = stars[i];
                star.z -= speed;

                if (star.z <= 0) {
                    if (!star.isSpecial) {
                        score += 1;
                    }
                    Object.assign(star, createStar(i));
                    star.z = canvas.width;
                }

                const sx = (star.x - ship.x) * (canvas.width / star.z) + ship.x;
                const sy = (star.y - ship.y) * (canvas.width / star.z) + ship.y;
                const size = Math.max((1 - star.z / canvas.width) * star.size, 4);
                
                context.fillStyle = star.isSpecial ? "red" : "white";
                context.fillRect(sx, sy, size, size);

                // Collision detection
                if (sx > ship.x - ship.width / 2 && sx < ship.x + ship.width / 2 && sy > ship.y - ship.height / 2 && sy < ship.y + ship.height / 2) {
                    if (star.isSpecial) {
                        score += 1000;
                        Object.assign(star, createStar(i));
                        star.z = canvas.width;
                    } else {
                        gameOver();
                        return;
                    }
                }
            }

            // Comets
            if (score % 100 === 0) {
                comets.push(createComet());
            }

            for (let i = 0; i < comets.length; i++) {
                let comet = comets[i];
                comet.x += comet.vx;
                comet.y += comet.vy;

                context.fillStyle = "orange";
                context.beginPath();
                context.arc(comet.x, comet.y, comet.size, 0, Math.PI * 2);
                context.fill();

                if (comet.x < 0 || comet.x > canvas.width || comet.y < 0 || comet.y > canvas.height) {
                    comets.splice(i, 1);
                    i--;
                }

                if (comet.x > ship.x - ship.width / 2 && comet.x < ship.x + ship.width / 2 && comet.y > ship.y - ship.height / 2 && comet.y < ship.y + ship.height / 2) {
                    gameOver();
                    return;
                }
            }

            scoreDiv.textContent = `Score: ${score}`;
            highScoreDiv.textContent = `High Score: ${highScore}`;

            // Increase speed and number of stars based on the score
            speed = baseSpeed + Math.floor(score / 10000);
            if (score % 10000 === 0) {
                numStars += 200;
                populateStars();
            }

            requestAnimationFrame(updateStars);
        }

        function initGame() {
            canvas.addEventListener('mousemove', (event) => {
                ship.x = event.clientX;
                ship.y = event.clientY;
                canvas.removeEventListener('mousemove', initGame); // Remove the event listener after the first movement
            });

            shipImg.onload = () => {
                populateStars();
                updateStars();
            };
        }

        initGame();
    </script>
</body>

</html>
